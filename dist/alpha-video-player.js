!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AlphaVideoPlayer2D=e():t.AlphaVideoPlayer2D=e()}(this,(()=>(()=>{"use strict";var t={d:(e,i)=>{for(var o in i)t.o(i,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:i[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>i});const i=function(){function t(t){var e=this;this.rafId=-1,this.isReady=!1,this.isPlaying=!1,this.offlineCanvas=null,this.offlineContext=null,this.rafId=-1,this.opts=t||{};var i,o=t.url,a=t.el;a instanceof HTMLCanvasElement?i=a:((i=document.createElement("canvas")).style.width="100%",i.style.height="100%",a.appendChild(i)),i.width=1*t.width,i.height=1*t.height,this.context=i.getContext("2d"),this.videoScript=document.createElement("video"),this.videoScript.width=2*t.width,this.videoScript.height=t.height,this.videoScript.controls=!1,this.videoScript.playsInline=!0,this.videoScript.loop=t.loop||!1,this.videoScript.autoplay=!1,this.videoScript.muted=!0,this.videoScript.crossOrigin="Anonymous",this.videoScript["x5-video-player-type"]="h5",this.videoScript.src=o,this.videoScript.addEventListener("loadedmetadata",(function(){e.isReady=!0,t.loadedCallback&&t.loadedCallback(),t.autoplay&&e.play()})),this.videoScript.addEventListener("ended",this.handleEnd);var n=document.createElement("canvas");n.width=1*t.width*2,n.height=1*t.height,this.offlineCanvas=n,this.offlineContext=n.getContext("2d",{willReadFrequently:!0})}return t.prototype.handleEnd=function(){this.opts.loop||this.pause(),this.opts.endCallback&&this.opts.endCallback()},t.prototype.animation=function(){var t=this;if(this.isReady){var e=this.context,i=this.offlineContext;if(e&&i){var o=this.offlineCanvas.width,a=this.offlineCanvas.height;i.drawImage(this.videoScript,0,0,o,a);for(var n=i.getImageData(0,0,o/2,a),s=i.getImageData(o/2,0,o/2,a),r=n.data,d=3,h=r.length;d<h;d+=4)s.data[d]=r[d-3];var l=s;e.putImageData(l,0,0,0,0,o/2,a),this.isPlaying&&(this.rafId=requestAnimationFrame((function(){t.animation()})))}else console.error("canvas context is null")}else this.rafId=requestAnimationFrame((function(){t.animation()}))},t.prototype.destory=function(){this.pause(),this.videoScript.removeEventListener("ended",this.handleEnd),this.offlineCanvas&&this.offlineCanvas.remove&&this.offlineCanvas.remove(),this.videoScript&&this.videoScript.remove&&this.videoScript.remove()},t.prototype.pause=function(){this.videoScript.pause(),this.isPlaying=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=-1)},t.prototype.play=function(){this.rafId&&cancelAnimationFrame&&(cancelAnimationFrame(this.rafId),this.rafId=-1),this.videoScript.play(),this.isPlaying=!0,this.animation()},t}();return e})()));